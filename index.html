<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>xplore Domäne Dahlem</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="no-referrer" />
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.awesome-markers/dist/leaflet.awesome-markers.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
  <!-- Marker clustering styles -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <style>
    html, body { margin: 0; padding: 0; height: 100%; }
    /* Prevent background overscroll/bounce on mobile */
    html, body { overscroll-behavior: none; }
    :root {
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }
    #map { width: 100%; height: 100dvh; padding-top: var(--safe-top); padding-bottom: var(--safe-bottom); }
    @supports not (height: 100dvh) {
      #map { height: 100vh; }
    }
    .leaflet-popup-content { overflow-wrap: anywhere; word-break: break-word; max-height: 56vh; overflow-y: auto; }
      /* Ensure last line isn't clipped at bottom when scrolled */
      .leaflet-popup-content { padding-bottom: 16px; }
    .popup-fotos { display: flex; gap: 8px; flex-wrap: wrap; align-items: flex-start; }
    .popup-fotos .foto-icon { display: inline-flex; width: 28px; height: 28px; align-items: center; justify-content: center; background: #ff0084; color: #fff; border-radius: 4px; text-decoration: none; }
    .popup-fotos .foto-icon .fa { font-size: 16px; line-height: 1; }
    /* Ensure no extra background behind inner icon */
    .awesome-marker i { background: transparent !important; }

    /* Mobile tweaks */
    @media (max-width: 480px) {
      .leaflet-popup { width: min(92vw, 360px); }
        .leaflet-popup-content { max-height: 64vh; }
      .leaflet-bar a { width: 44px; height: 44px; line-height: 44px; }
      .leaflet-bar button { width: 44px; height: 44px; line-height: 44px; }
    }

    /* Mobile full-screen popup overlay */
    #mobile-popup { position: fixed; inset: 0; background: #fff; z-index: 10000; display: none; }
    #mobile-popup .mp-header { display: flex; align-items: center; gap: 8px; padding: calc(8px + var(--safe-top)) 12px 8px 12px; border-bottom: 1px solid #e5e5e5; }
    #mobile-popup .mp-header .mp-back { display: inline-flex; align-items: center; gap: 8px; background: transparent; border: none; font: 16px system-ui, sans-serif; padding: 8px; color: #111; }
    #mobile-popup .mp-body { padding: 12px; height: calc(100dvh - 56px - var(--safe-top) - var(--safe-bottom)); overflow-y: auto; overscroll-behavior: contain; }

    /* Slightly smaller AwesomeMarkers globally */
    .awesome-marker, .awesome-marker-shadow {
      transform: scale(0.85);
      transform-origin: bottom center;
    }
    /* Make custom buttons inside leaflet-bar feel native */
    .leaflet-bar button {
      display: inline-block;
      background: #fff;
      color: #000;
      border: 1px solid rgba(0,0,0,0.2);
      border-radius: 4px;
      padding: 0;
      margin: 0;
      cursor: pointer;
      text-align: center;
    }
    .leaflet-bar button:focus-visible { outline: 2px solid #1f6feb; outline-offset: 2px; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="mobile-popup" aria-hidden="true">
    <div class="mp-header">
      <button id="mp-back" class="mp-back" aria-label="Zurück"><i class="fa fa-arrow-left"></i><span>Zurück</span></button>
    </div>
    <div class="mp-body" id="mp-body"></div>
  </div>
  <div id="boot-log" style="position:fixed;left:8px;bottom:8px;background:rgba(0,0,0,0.6);color:#fff;padding:6px 8px;border-radius:4px;font:12px system-ui;z-index:9999;display:none"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet.awesome-markers/dist/leaflet.awesome-markers.js"></script>
  <script src="https://unpkg.com/leaflet-providers@1.13.0/leaflet-providers.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
  <!-- Marker clustering -->
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

  <!-- Global error hook: surface JS errors to #boot-log for Simple Browser debugging -->
  <script>
    (function(){
      function write(msg){
        try{
          var el = document.getElementById('boot-log');
          if(el){ el.style.display = 'block'; el.textContent = String(msg).slice(0,1000); }
          console.error('BootLog:', msg);
        }catch(e){}
      }
      window.addEventListener('error', function(e){ write('Error: '+(e && e.message) + ' at ' + (e && e.filename) + ':' + (e && e.lineno)); });
      window.addEventListener('unhandledrejection', function(e){ write('PromiseRejection: '+ (e && e.reason && e.reason.stack) || String(e)); });
      window.onerror = function(msg, src, lineno){ write('onerror: '+msg+' @'+src+':'+lineno); };
    })();
  </script>

  <script src="js/main.js?v=init1" defer></script>
</body>
</html>
